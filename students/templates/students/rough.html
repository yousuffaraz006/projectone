<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Student List</title>

    <!-- Bootstrap 5 -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap Icons -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet">
</head>

<body class="bg-light">

<!-- NAVBAR -->
<nav class="navbar navbar-dark bg-dark px-4">
    <span class="navbar-brand">Student List</span>
</nav>

<!-- BREADCRUMB -->
<nav class="bg-white border-bottom px-4 py-2">
    <ol class="breadcrumb mb-0">
        <li class="breadcrumb-item">Home</li>
        <li class="breadcrumb-item active">Students</li>
    </ol>
</nav>

<!-- CONTENT -->
<div class="container mt-4 mb-5">

    <div class="d-flex justify-content-between align-items-center mb-3">
        <h4 class="mb-0">Students</h4>
        <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addStudentModal">
            <i class="bi bi-plus-circle"></i> Add New
        </button>
    </div>

    <div class="card shadow-sm">
        <div class="card-body p-0">
            <table class="table table-hover table-striped mb-0">
                <thead class="table-dark">
                    <tr>
                        <th>Name</th>
                        <th>Class</th>
                        <th>Roll No</th>
                        <th class="text-center">Action</th>
                    </tr>
                </thead>
                <tbody>
                {% for student in students %}
                    <tr>
                        <td>{{ student.first_name }} {{ student.last_name }}</td>
                        <td>{{ student.class_name }}</td>
                        <td>{{ student.roll_number }}</td>
                        <td class="text-center">

                            <!-- EDIT -->
                            <a href="#" class="text-primary me-3"
                               data-bs-toggle="modal"
                               data-bs-target="#editStudentModal"
                               data-id="{{ student.id }}"
                               data-first-name="{{ student.first_name }}"
                               data-last-name="{{ student.last_name }}"
                               data-roll="{{ student.roll_number }}"
                               data-class="{{ student.class_name }}"
                               data-email="{{ student.email }}"
                               data-dob="{{ student.date_of_birth|date:'Y-m-d' }}">
                                <i class="bi bi-pencil-square fs-5"></i>
                            </a>

                            <!-- DELETE -->
                            <a href="#" class="text-danger"
                               data-bs-toggle="modal"
                               data-bs-target="#deleteStudentModal"
                               data-id="{{ student.id }}"
                               data-name="{{ student.first_name }} {{ student.last_name }}">
                                <i class="bi bi-trash fs-5"></i>
                            </a>

                        </td>
                    </tr>
                {% empty %}
                    <tr>
                        <td colspan="4" class="text-center py-4">No students found</td>
                    </tr>
                {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>

<!-- ADD STUDENT MODAL -->
<div class="modal fade" id="addStudentModal" tabindex="-1">
    <div class="modal-dialog modal-lg modal-dialog-centered modal-dialog-scrollable">
        <div class="modal-content">
            <div class="modal-header bg-primary text-white">
                <h5 class="modal-title">Add Student</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>

            <form method="post" action="{% url 'student_create' %}">
                {% csrf_token %}
                <div class="modal-body">
                    <div class="row g-3">
                        <div class="col-md-6">
                            <label class="form-label">First Name</label>
                            {{ form.first_name }}
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">Last Name</label>
                            {{ form.last_name }}
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">Roll Number</label>
                            {{ form.roll_number }}
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">Class</label>
                            {{ form.class_name }}
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">Email</label>
                            {{ form.email }}
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">Date of Birth</label>
                            {{ form.date_of_birth }}
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" type="reset" data-bs-dismiss="modal">Cancel</button>
                    <button class="btn btn-primary" type="submit">Save</button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- EDIT STUDENT MODAL -->
<div class="modal fade" id="editStudentModal" tabindex="-1">
    <div class="modal-dialog modal-lg modal-dialog-centered modal-dialog-scrollable">
        <div class="modal-content">
            <div class="modal-header bg-primary text-white">
                <h5 class="modal-title">Edit Student</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>

            <form method="post" id="editForm">
                {% csrf_token %}
                <div class="modal-body">
                    <div class="row g-3">
                        <div class="col-md-6">
                            <label class="form-label">First Name</label>
                            <input type="text" name="first_name" class="form-control" id="editFirstName">
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">Last Name</label>
                            <input type="text" name="last_name" class="form-control" id="editLastName">
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">Roll Number</label>
                            <input type="text" name="roll_number" class="form-control" id="editRoll">
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">Class</label>
                            <input type="text" name="class_name" class="form-control" id="editClass">
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">Email</label>
                            <input type="email" name="email" class="form-control" id="editEmail">
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">Date of Birth</label>
                            <input type="date" name="date_of_birth" class="form-control" id="editDob">
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" type="reset" data-bs-dismiss="modal">Cancel</button>
                    <button class="btn btn-primary" type="submit">Update</button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- DELETE MODAL -->
<div class="modal fade" id="deleteStudentModal" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header bg-danger text-white">
                <h5 class="modal-title">Confirm Delete</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                Are you sure you want to delete <strong id="deleteStudentName"></strong>?
            </div>
            <div class="modal-footer">
                <form method="post" id="deleteForm">
                    {% csrf_token %}
                    <button class="btn btn-secondary" type="reset" data-bs-dismiss="modal">Cancel</button>
                    <button class="btn btn-danger" type="submit">Delete</button>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- FIXED BOTTOM RIBBON -->
<div class="position-fixed bottom-0 w-100 bg-danger text-white text-center py-2">
    Time: <span id="time"></span>
    IP: <span id="ip"></span>
</div>

<!-- SCRIPTS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

<script>
    document.getElementById('editStudentModal').addEventListener('show.bs.modal', function (e) {
        const btn = e.relatedTarget;
        document.getElementById('editForm').action = `/students/edit/${btn.dataset.id}/`;
        editFirstName.value = btn.dataset.firstName;
        editLastName.value = btn.dataset.lastName;
        editRoll.value = btn.dataset.roll;
        editClass.value = btn.dataset.class;
        editEmail.value = btn.dataset.email;
        editDob.value = btn.dataset.dob;
    });

    document.getElementById('deleteStudentModal').addEventListener('show.bs.modal', function (e) {
        const btn = e.relatedTarget;
        document.getElementById('deleteStudentName').innerText = btn.dataset.name;
        document.getElementById('deleteForm').action = `/students/delete/${btn.dataset.id}/`;
    });

    setInterval(() => {
        document.getElementById('time').innerText = new Date().toLocaleString();
    }, 1000);
    
</script>

</body>
</html>

